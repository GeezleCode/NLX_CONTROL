<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of spk_NLX_readNSE</title>
  <meta name="keywords" content="spk_NLX_readNSE">
  <meta name="description" content="reads spike data from a neuralynx *.nse file">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">@al_spk</a> &gt; spk_NLX_readNSE.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for @al_spk&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>spk_NLX_readNSE
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>reads spike data from a neuralynx *.nse file</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function s = spk_NLX_readNSE(s,NSE,NLXWin,ElName,WinMode,AddChannelFlag) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> reads spike data from a neuralynx *.nse file

 NSE ................ NSE structure, see Neuralynx Tools
 NLXWin ............. time window for every trial in NLX time (microsec), trials
                           along rows.
 ElName ............. is only used to contruct the channel name
 WinMode ............ 'REL' NLXWin times are relative. s.align is
                            used to construct neuralynx times
                      'ABS' NLXWin times are absolute neuralynx times
                            s.align is substracted for alignment
 AddChannelFlag ..... if 1 existing channels won't be deleted</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="error.html" class="code" title="function msgOut = error(s,msgIn,caller)">error</a>	Report an error that occurred in a spike object</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function s = spk_NLX_readNSE(s,NSE,NLXWin,ElName,WinMode,AddChannelFlag)</a>
0002 
0003 <span class="comment">% reads spike data from a neuralynx *.nse file</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% NSE ................ NSE structure, see Neuralynx Tools</span>
0006 <span class="comment">% NLXWin ............. time window for every trial in NLX time (microsec), trials</span>
0007 <span class="comment">%                           along rows.</span>
0008 <span class="comment">% ElName ............. is only used to contruct the channel name</span>
0009 <span class="comment">% WinMode ............ 'REL' NLXWin times are relative. s.align is</span>
0010 <span class="comment">%                            used to construct neuralynx times</span>
0011 <span class="comment">%                      'ABS' NLXWin times are absolute neuralynx times</span>
0012 <span class="comment">%                            s.align is substracted for alignment</span>
0013 <span class="comment">% AddChannelFlag ..... if 1 existing channels won't be deleted</span>
0014 
0015 <span class="keyword">if</span> nargin&lt;6
0016     AddChannelFlag = 0;
0017     <span class="keyword">if</span> nargin&lt;5
0018         WinMode = <span class="string">'ABS'</span>;
0019         <span class="keyword">if</span> nargin&lt;4
0020             ElName = <span class="string">'Sc1'</span>;
0021         <span class="keyword">end</span>;<span class="keyword">end</span>;<span class="keyword">end</span>
0022 
0023 TimeDimDiff = (-6) - s.timeorder;
0024 
0025 <span class="comment">% check clusters</span>
0026 NLXcells = unique(NSE.ClusterNr);
0027 NLXcellNum = length(NLXcells);
0028 <span class="keyword">if</span> NLXcellNum==0
0029     warning(<span class="string">'spk_NLX_readNSE: did not find any spikes!'</span>);
0030     <span class="keyword">return</span>;
0031 <span class="keyword">end</span>
0032 <span class="keyword">for</span> i=1:NLXcellNum
0033     ChannelNames{i} = sprintf([ElName <span class="string">'.%02.0f'</span>],NLXcells(i));
0034 <span class="keyword">end</span>
0035 
0036 <span class="comment">% clear object from spike data</span>
0037 numTrials = size(s.events,2);
0038 
0039 <span class="keyword">if</span> AddChannelFlag
0040     NumChan = size(s.spk,1);
0041     <span class="keyword">if</span> any(ismember(s.channel,ChannelNames))
0042         <a href="error.html" class="code" title="function msgOut = error(s,msgIn,caller)">error</a>(<span class="string">'Found duplicate channel names!'</span>);
0043     <span class="keyword">end</span>
0044     <span class="keyword">if</span> isempty(s.channel)&amp;NumChan==0
0045         s.spk = {};
0046         s.channel = {};
0047     <span class="keyword">end</span>
0048     s.spk(NumChan+1:NumChan+NLXcellNum,:) = {[]};
0049     s.channel(NumChan+1:NumChan+NLXcellNum) = ChannelNames;
0050 <span class="keyword">else</span>
0051     NumChan = 0;
0052     s.spk = cell(NLXcellNum,numTrials);
0053     s.channel = ChannelNames;
0054 <span class="keyword">end</span>
0055 
0056 <span class="comment">% loop trials</span>
0057 hwait = waitbar(0,<span class="string">'Extract spikes from neuralynx NSE file ...'</span>);
0058 <span class="keyword">for</span> i = 1:numTrials
0059     
0060     <span class="comment">% load spike times into object</span>
0061     <span class="keyword">for</span> j = 1:NLXcellNum
0062         chanInd = NumChan+j;
0063         <span class="comment">% load spikes</span>
0064         <span class="comment">% extract the ncs data</span>
0065         <span class="keyword">switch</span> upper(WinMode)
0066             <span class="keyword">case</span> <span class="string">'REL'</span>
0067                 <span class="keyword">if</span> size(NLXWin,1)&gt;1
0068                     s.spk{chanInd,i} =  NSE.TimeStamps(NSE.ClusterNr==NLXcells(j) &amp; NSE.TimeStamps&gt;=(NLXWin(i,1)+s.align(i))./(10^TimeDimDiff) &amp; NSE.TimeStamps&lt;=(NLXWin(2)+s.align(i))./(10^TimeDimDiff)) .* (10^TimeDimDiff) - s.align(i);
0069                 <span class="keyword">else</span>
0070                     s.spk{chanInd,i} =  NSE.TimeStamps(NSE.ClusterNr==NLXcells(j) &amp; NSE.TimeStamps&gt;=(NLXWin(1)+s.align(i))./(10^TimeDimDiff) &amp; NSE.TimeStamps&lt;=(NLXWin(2)+s.align(i))./(10^TimeDimDiff)) .* (10^TimeDimDiff) - s.align(i);
0071                 <span class="keyword">end</span>
0072             <span class="keyword">case</span> <span class="string">'ABS'</span>
0073                 <span class="keyword">if</span> size(NLXWin,1)&gt;1
0074                     s.spk{chanInd,i} =  NSE.TimeStamps(NSE.ClusterNr==NLXcells(j) &amp; NSE.TimeStamps&gt;=NLXWin(i,1) &amp; NSE.TimeStamps&lt;=NLXWin(i,2)) .* (10^TimeDimDiff) - s.align(i);
0075                 <span class="keyword">else</span>
0076                     <a href="error.html" class="code" title="function msgOut = error(s,msgIn,caller)">error</a>(<span class="string">''</span>);
0077                 <span class="keyword">end</span>
0078                 
0079         <span class="keyword">end</span>
0080     <span class="keyword">end</span>
0081     waitbar(i/numTrials,hwait);
0082 <span class="keyword">end</span>
0083 close(hwait);
0084 
0085     
0086</pre></div>
<hr><address>Generated on Thu 05-Nov-2009 11:31:16 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>