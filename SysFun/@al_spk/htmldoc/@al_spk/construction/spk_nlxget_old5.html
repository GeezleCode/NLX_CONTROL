<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of spk_nlxget_old5</title>
  <meta name="keywords" content="spk_nlxget_old5">
  <meta name="description" content="connects to a cheetah data acquisition software and writes data into a">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">@al_spk</a> &gt; <a href="index.html">construction</a> &gt; spk_nlxget_old5.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for @al_spk\construction&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>spk_nlxget_old5
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>connects to a cheetah data acquisition software and writes data into a</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function s = spk_nlxget(s,p,dofun) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> connects to a cheetah data acquisition software and writes data into a
 @al_spk object
 object is continously assigned the base workspace as variable SPK or is
 written into the figures ('tag','nlx_control') userdata.

 s ....... @al_spk object
 p ....... cheetah acquisition settings (struct)
 dofun ... cell array with functions to evaluate after every trial
           first cell of a row is the function, every other cell of the
           are the input arguments of the function</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../@al_spk/error.html" class="code" title="function msgOut = error(s,msgIn,caller)">error</a>	Report an error that occurred in a spike object</li><li><a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>	returns the index of a trialcodelabel</li><li><a href="../../@al_spk/spk_gettrialcodes.html" class="code" title="function [TrialCodes,TrialCodeLabelIndex] = spk_gettrialcodes(s,TrialCodeLabel)">spk_gettrialcodes</a>	returns the trial codes trials trials given in s.currenttrials ; set by >>spk_set(s,'currentrials',[ ... ])</li><li><a href="../../@al_spk/spk_numtrials.html" class="code" title="function total = spk_numtrials(s)">spk_numtrials</a>	returns and check for number of trials in @al_spk object</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = registerevent(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt)</a></li><li><a href="#_sub2" class="code">function printeventmessage(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt)</a></li><li><a href="#_sub3" class="code">function [spikedata,flushnum] = flushspikes(cheetah,cheetahobjname,flushwin)</a></li><li><a href="#_sub4" class="code">function [eventdata,flushnum] = flushevents(cheetah,cheetahobjname,flushwin)</a></li></ul>
<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function s = spk_nlxget(s,p,dofun)</a>
0002 
0003 <span class="comment">% connects to a cheetah data acquisition software and writes data into a</span>
0004 <span class="comment">% @al_spk object</span>
0005 <span class="comment">% object is continously assigned the base workspace as variable SPK or is</span>
0006 <span class="comment">% written into the figures ('tag','nlx_control') userdata.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% s ....... @al_spk object</span>
0009 <span class="comment">% p ....... cheetah acquisition settings (struct)</span>
0010 <span class="comment">% dofun ... cell array with functions to evaluate after every trial</span>
0011 <span class="comment">%           first cell of a row is the function, every other cell of the</span>
0012 <span class="comment">%           are the input arguments of the function</span>
0013 
0014 <span class="comment">% 18/5/05 changed channel naming from '1'=unclassified to '0'=unclassified</span>
0015 
0016 <span class="keyword">global</span> DO_GET_NLX_DATA
0017 
0018 
0019 <span class="comment">%++++++++++++++++++++++ connect to cheetah +++++++++++++++++++++++++++++++++</span>
0020 cheetah = actxserver(<span class="string">'Cheetah.ExperimentControl'</span>);
0021 
0022 h = msgbox(<span class="string">'Make sure to RECORD the CHEETAH DATA by starting the CheetahEventResponder executable or by pushing the RED record button manually !!!'</span>,<span class="string">'NEURALYNX control'</span>,<span class="string">'warn'</span>);
0023 uiwait;
0024 <span class="comment">%++++++++++++++++++++++ prepare logfile+++++++++++++++++++++++++++++++++++++</span>
0025 logfiledir = <span class="string">'c:\NLX_control'</span>;
0026 <span class="keyword">if</span> exist(logfiledir,<span class="string">'dir'</span>) ~= 7;
0027     logfiledir = uigetdir(<span class="string">''</span>,<span class="string">'select a directory for the NLXLOG file ...'</span>);
0028 <span class="keyword">end</span>
0029 currtime = now;
0030 currdate = datestr(now,30);
0031 logfilename = [<span class="string">'NLXLOG_'</span> currdate(1:8) <span class="string">'.txt'</span>];
0032 logfilepath = fullfile(logfiledir,logfilename);
0033 <span class="keyword">if</span> exist(logfilepath,<span class="string">'file'</span>);
0034     fpermission = <span class="string">'a'</span>;
0035 <span class="keyword">else</span> 
0036     fpermission = <span class="string">'w'</span>;
0037 <span class="keyword">end</span>
0038 logfid = fopen(logfilepath,fpermission);
0039 fprintf(1,[<span class="string">'\n'</span>]);
0040 fprintf(1,[<span class="string">'-------------------------------------------------------------------------------\n'</span>]);
0041 fprintf(1,(strrep([<span class="string">'write to '</span> fullfile(cd,logfilepath) <span class="string">' !'</span>],<span class="string">'\'</span>,<span class="string">'/'</span>)));
0042 fprintf(1,[<span class="string">'\n'</span>]);
0043 fprintf(1,[<span class="string">'-------------------------------------------------------------------------------\n'</span>]);
0044 fprintf(logfid,[<span class="string">'\n'</span>]);
0045 fprintf(logfid,[<span class="string">'-------------------------------------------------------------------------------\n'</span>]);
0046 fprintf(logfid,[<span class="string">'log file opened: '</span> datestr(currtime,0) <span class="string">' NLX time: %12.0f\n'</span>],invoke(cheetah,<span class="string">'GetTimeStampAsDouble'</span>));
0047 fprintf(logfid,[<span class="string">'-------------------------------------------------------------------------------\n'</span>]);
0048 
0049 
0050 <span class="comment">%++++++++++++++++++++++ flush spike buffer from useless spike data</span>
0051 flushwin = [0 invoke(cheetah,<span class="string">'GetTimeStampAsDouble'</span>)];
0052 
0053 [spikedata,flushnum] = <a href="#_sub3" class="code" title="subfunction [spikedata,flushnum] = flushspikes(cheetah,cheetahobjname,flushwin)">flushspikes</a>(cheetah,p.SpikeObjName{1},flushwin);
0054 fprintf(1,[<span class="string">'\nSPIKES: %5u flushed \t%12.0f %12.0f'</span>],flushnum,flushwin(1),flushwin(2));
0055 fprintf(logfid,[<span class="string">'\nSPIKES: %5u flushed \t%12.0f %12.0f'</span>],flushnum,flushwin(1),flushwin(2));
0056 
0057 [eventdata,flushnum] = <a href="#_sub4" class="code" title="subfunction [eventdata,flushnum] = flushevents(cheetah,cheetahobjname,flushwin)">flushevents</a>(cheetah,p.EventObjName,flushwin);
0058 fprintf(1,[<span class="string">'\nEVENTS: %5u flushed \t%12.0f %12.0f\n'</span>],flushnum,flushwin(1),flushwin(2));
0059 fprintf(logfid,[<span class="string">'\nEVENTS: %5u flushed \t%12.0f %12.0f\n'</span>],flushnum,flushwin(1),flushwin(2));
0060 
0061 <span class="comment">%++++++++++++++++++++++ check object +++++++++++++++++++++++++++++++++</span>
0062 spk_BlockInd = <a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>(s,<span class="string">'block'</span>);
0063 <span class="keyword">if</span> isempty(spk_BlockInd)
0064     s.trialcodelabel = cat(2,s.trialcodelabel,{<span class="string">'block'</span>});
0065     spk_BlockInd = length(s.trialcodelabel);
0066 <span class="keyword">end</span>
0067 <span class="comment">%--------------------------------------------------------------------</span>
0068 spk_CndInd = <a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>(s,<span class="string">'condition'</span>);
0069 <span class="keyword">if</span> isempty(spk_CndInd)
0070     s.trialcodelabel = cat(2,s.trialcodelabel,{<span class="string">'condition'</span>});
0071     spk_CndInd = length(s.trialcodelabel);
0072 <span class="keyword">end</span>
0073 <span class="comment">%--------------------------------------------------------------------</span>
0074 spk_PresentNrInd = <a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>(s,<span class="string">'presentationnr'</span>);
0075 <span class="keyword">if</span> isempty(spk_PresentNrInd)
0076     s.trialcodelabel = cat(2,s.trialcodelabel,{<span class="string">'presentationnr'</span>});
0077     spk_PresentNrInd = length(s.trialcodelabel);
0078 <span class="keyword">end</span>
0079 <span class="comment">%--------------------------------------------------------------------</span>
0080 spk_cortextrialcountind = <a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>(s,<span class="string">'CortexTrialCount'</span>);
0081 <span class="keyword">if</span> isempty(spk_cortextrialcountind)
0082     s.trialcodelabel = cat(2,s.trialcodelabel,{<span class="string">'CortexTrialCount'</span>});
0083     spk_cortextrialcountind = length(s.trialcodelabel);
0084 <span class="keyword">end</span>
0085 <span class="comment">%--------------------------------------------------------------------</span>
0086 spk_startedtrialcountind = <a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>(s,<span class="string">'StartedTrialCount'</span>);
0087 <span class="keyword">if</span> isempty(spk_startedtrialcountind)
0088     s.trialcodelabel = cat(2,s.trialcodelabel,{<span class="string">'StartedTrialCount'</span>});
0089     spk_startedtrialcountind = length(s.trialcodelabel);
0090 <span class="keyword">end</span>
0091 <span class="comment">%--------------------------------------------------------------------</span>
0092 spk_timeInd = <a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>(s,<span class="string">'time'</span>);
0093 <span class="keyword">if</span> isempty(spk_timeInd)
0094     s.trialcodelabel = cat(2,s.trialcodelabel,{<span class="string">'time'</span>});
0095     spk_timeInd = length(s.trialcodelabel);
0096 <span class="keyword">end</span>
0097 <span class="comment">%--------------------------------------------------------------------</span>
0098 spk_TrialInd = <a href="../../@al_spk/spk_findtrialcodelabel.html" class="code" title="function i = spk_findtrialcodelabel(s,trialcodelabel)">spk_findtrialcodelabel</a>(s,<span class="string">'trialnr'</span>);
0099 <span class="keyword">if</span> isempty(spk_TrialInd)
0100     s.trialcodelabel = cat(2,s.trialcodelabel,{<span class="string">'trialnr'</span>});
0101     spk_TrialInd = length(s.trialcodelabel);
0102 <span class="keyword">end</span>
0103 TRIALCNTinObj2 = <a href="../../@al_spk/spk_gettrialcodes.html" class="code" title="function [TrialCodes,TrialCodeLabelIndex] = spk_gettrialcodes(s,TrialCodeLabel)">spk_gettrialcodes</a>(s,<span class="string">'trialnr'</span>,[]);
0104 <span class="keyword">if</span> isempty(TRIALCNTinObj2)
0105     TRIALCNTinObj2 = 0;
0106 <span class="keyword">else</span>
0107     TRIALCNTinObj2 = max(<a href="../../@al_spk/spk_gettrialcodes.html" class="code" title="function [TrialCodes,TrialCodeLabelIndex] = spk_gettrialcodes(s,TrialCodeLabel)">spk_gettrialcodes</a>(s,<span class="string">'trialnr'</span>,[]));
0108 <span class="keyword">end</span>
0109 <span class="comment">%--------------------------------------------------------------------</span>
0110 <span class="keyword">if</span> isempty(s.channel)
0111     s.channel = {<span class="string">'0'</span> <span class="string">'1'</span> <span class="string">'2'</span> <span class="string">'3'</span> <span class="string">'4'</span> <span class="string">'5'</span>};
0112     s.chancolor = [ <span class="keyword">...</span>
0113             1 1 1; <span class="keyword">...</span><span class="comment">      white</span>
0114             1 0 0; <span class="keyword">...</span><span class="comment">      red</span>
0115             0 1 0; <span class="keyword">...</span><span class="comment">      green</span>
0116             0 0 1; <span class="keyword">...</span><span class="comment">      blue</span>
0117             1 1 0; <span class="keyword">...</span><span class="comment">       yellow</span>
0118             .5 0 1 <span class="keyword">...</span><span class="comment">     purple;</span>
0119         ];
0120 <span class="keyword">end</span>
0121 ChanIndex = spk_getchannelindex(s,{<span class="string">'0'</span> <span class="string">'1'</span> <span class="string">'2'</span> <span class="string">'3'</span> <span class="string">'4'</span> <span class="string">'5'</span>});
0122 ChanIndex(isnan(ChanIndex)) = [];
0123 ChanIndexNum = length(ChanIndex);
0124 
0125 <span class="comment">%--------------------------------------------------------------------</span>
0126 <span class="keyword">if</span> isempty(s.eventlabel)
0127     s.eventlabel = p.EventName;
0128 <span class="keyword">end</span>
0129 <span class="comment">%--------------------------------------------------------------------</span>
0130 <span class="keyword">if</span> isempty(s.date)
0131     s.date = datestr(now,30);
0132 <span class="keyword">end</span>
0133 <span class="comment">%--------------------------------------------------------------------</span>
0134 <span class="comment">% timestmaps in milliseconds</span>
0135 s.timeorder = -3;
0136 
0137 
0138 
0139 <span class="comment">%+++++++++++++++++++++ initialise ++++++++++++++++++++++++++++++++</span>
0140 spkTime     = zeros(1,3000);
0141 spkChannel  = zeros(1,3000);
0142 spkCell     = zeros(1,3000);
0143 <span class="comment">%--------------------------------------------------------------------</span>
0144 <span class="comment">% event codes encoding process flow of trial</span>
0145 evcnt = 0;<span class="comment">% event counter for the current trial</span>
0146 evTime      = zeros(1,500);<span class="comment">% vector of event times</span>
0147 evID        = zeros(1,500);
0148 evTTL       = zeros(1,500);
0149 evBINhi       = char(500,8);<span class="comment">% event code as binary</span>
0150 evBINlo       = char(500,8);
0151 evType = zeros(1,500).*NaN;
0152 
0153 <span class="comment">%--------------------------------------------------------------------</span>
0154 currBlock = NaN;
0155 currCnd = NaN;
0156 <span class="comment">%--------------------------------------------------------------------</span>
0157 TRIALCNTinObj = <a href="../../@al_spk/spk_numtrials.html" class="code" title="function total = spk_numtrials(s)">spk_numtrials</a>(s);<span class="comment">% trial counter of READ trials for the current loop</span>
0158 <span class="comment">% dont uncomment !! TRIALCNTinObj2 is trial counter for data object</span>
0159 TRIALCNTstarted = 0;<span class="comment">% counts cortex trial starts in this session</span>
0160 currTRIALinObj = zeros(1,p.PresentationNum).*NaN;<span class="comment">% current presented array of READ trials in Object</span>
0161 
0162 <span class="keyword">if</span> ~isempty(s.trialcode)
0163     TRIALCNTcortex = max(s.trialcode(spk_cortextrialcountind,:));<span class="comment">% counts cortex trials</span>
0164 <span class="keyword">else</span>
0165     TRIALCNTcortex = 0;
0166 <span class="keyword">end</span>
0167 
0168 <span class="comment">%--------------------------------------------------------------------</span>
0169 TRIAL_HANDBRAKE = 1;<span class="comment">% is set by the trial start and stop events</span>
0170 <span class="comment">%--------------------------------------------------------------------</span>
0171 spkcnt = 0;
0172 paramcnt = 0;
0173 do_READ_flag = 1;
0174 is_READ_flag = 0;
0175 FH = findobj(<span class="string">'type'</span>,<span class="string">'figure'</span>,<span class="string">'tag'</span>,<span class="string">'nlx_control'</span>);
0176 
0177 <span class="comment">%++++++++++++++ prepare plots and analyses ++++++++++++++++++++++++++++++++++++</span>
0178 <span class="keyword">for</span> f = 1:size(dofun,1)
0179     feval(dofun{f,:},s,[],p);
0180 <span class="keyword">end</span>
0181 
0182 
0183 <span class="comment">%+++++++++++++++++++++ collect data ++++++++++++++++++++++++++++++++</span>
0184 
0185 <span class="keyword">while</span> DO_GET_NLX_DATA
0186     
0187     <span class="comment">%______________________________________________________________________</span>
0188     <span class="comment">% wait for event</span>
0189     <span class="keyword">while</span> (eventdata(1) &lt; 0) | (eventdata(3) == 0) 
0190         pause(.01);
0191         eventdata = invoke(cheetah,<span class="string">'GetEventDataAsDouble'</span>,p.EventObjName);
0192         <span class="keyword">if</span> ~DO_GET_NLX_DATA;<span class="keyword">break</span>;<span class="keyword">end</span> <span class="comment">%DO_GET_NLX_DATA is set by nlx_control gui !!</span>
0193     <span class="keyword">end</span>
0194     <span class="keyword">if</span> ~DO_GET_NLX_DATA;<span class="keyword">break</span>;<span class="keyword">end</span>
0195 
0196     
0197     <span class="comment">%++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
0198     <span class="comment">% trial start event</span>
0199     <span class="comment">% only reset variables !!!</span>
0200     <span class="keyword">if</span> eventdata(3)==p.TrialStartEvent
0201         TRIAL_HANDBRAKE = 0;
0202         
0203         <span class="comment">% reset runnning variables</span>
0204         TRIALCNTstarted = TRIALCNTstarted + 1;
0205         currTRIALinObj = zeros(1,p.PresentationNum).*NaN;
0206         currTrialTime = now;
0207         do_READ_flag = 1;
0208         is_READ_flag = 0;
0209         currCnd = NaN;
0210         currBlock = NaN;
0211         
0212         evcnt = 0;
0213         evTime(:) = 0;evID(:) = 0;evTTL(:) = 0;evBINhi(:) = <span class="string">'0'</span>;evBINlo(:) = <span class="string">'0'</span>;evType(:) = 0;
0214         paramcnt = 0;
0215         paramArray = [];
0216         
0217         spkTime(:)      = 0;
0218         spkChannel(:)   = 0;
0219         spkCell(:)      = 0;
0220         
0221         fprintf(1,<span class="string">'\n\nTRIALS READ %u TRIALS STARTED %u TRIALS IN OBJECT %u'</span>,TRIALCNTinObj,TRIALCNTstarted,TRIALCNTinObj2);
0222         fprintf(logfid,<span class="string">'\n\nTRIALS READ %u TRIALS STARTED %u TRIALS IN OBJECT %u'</span>,TRIALCNTinObj,TRIALCNTstarted,TRIALCNTinObj2);
0223         fprintf(1,<span class="string">'\n\nNEW TRIAL'</span>);
0224         fprintf(logfid,<span class="string">'\n\nNEW TRIAL'</span>);
0225         
0226     <span class="keyword">end</span>
0227     <span class="comment">%++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
0228 
0229     
0230     
0231     
0232     <span class="comment">%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
0233     <span class="comment">% register event</span>
0234     [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = <a href="#_sub1" class="code" title="subfunction [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = registerevent(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt)">registerevent</a>(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt);
0235     evType(evcnt) = 0;
0236     <a href="#_sub2" class="code" title="subfunction printeventmessage(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt)">printeventmessage</a>(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt);
0237     <span class="comment">%--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
0238     
0239     
0240     
0241     
0242     <span class="comment">%++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
0243     <span class="comment">% choose action depending on the event</span>
0244     <span class="keyword">if</span>  eventdata(3)==p.SendConditionStart
0245         
0246         paramcnt = 0;
0247         eventdata(1:3) = -1001;
0248         
0249         <span class="comment">% read upcoming events as parameter values</span>
0250         <span class="keyword">while</span> (eventdata(1) &lt; 0) | (eventdata(3) ~= p.SendConditionEnd)
0251             eventdata = invoke(cheetah,<span class="string">'GetEventDataAsDouble'</span>,p.EventObjName);
0252             <span class="keyword">if</span> (eventdata(1) &lt; 0);
0253                 pause(.01);
0254             <span class="keyword">elseif</span> (eventdata(1) &gt; 0 &amp; eventdata(3) ~= 0);
0255                 [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = <a href="#_sub1" class="code" title="subfunction [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = registerevent(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt)">registerevent</a>(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt);
0256                 <span class="keyword">if</span> (eventdata(3)~= p.SendConditionEnd) <span class="comment">% read as condition number</span>
0257                     evType(evcnt) = 2;
0258                     <a href="#_sub2" class="code" title="subfunction printeventmessage(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt)">printeventmessage</a>(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt);
0259                 <span class="keyword">elseif</span> (eventdata(3)== p.SendConditionEnd) <span class="comment">% read as event</span>
0260                     evType(evcnt) = 1;
0261                     <a href="#_sub2" class="code" title="subfunction printeventmessage(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt)">printeventmessage</a>(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt);
0262                     <span class="keyword">break</span>;
0263                 <span class="keyword">end</span>
0264             <span class="keyword">end</span>
0265         <span class="keyword">end</span>
0266         
0267         <span class="comment">% reset condition and block array</span>
0268         currCnd = NaN;
0269         currBlock = NaN;
0270         
0271         currCnd = evTTL(evType==2);
0272         currBlock = currCnd(1);<span class="comment">% first number is the current block</span>
0273         currCnd = currCnd(2:end);<span class="comment">% third to n number are conditions</span>
0274         currCndNum = length(currCnd);
0275         fprintf(1,<span class="string">'\nBLOCK '</span>);fprintf(1,<span class="string">'%u '</span>,currBlock);
0276         fprintf(1,<span class="string">'\nCONDITION '</span>);fprintf(1,<span class="string">'%u '</span>,currCnd);
0277         fprintf(logfid,<span class="string">'\nBLOCK '</span>);fprintf(logfid,<span class="string">'%u '</span>,currBlock);
0278         fprintf(logfid,<span class="string">'\nCONDITION '</span>);fprintf(logfid,<span class="string">'%u '</span>,currCnd);
0279         
0280     <span class="keyword">elseif</span> eventdata(3)== p.SendParamStart<span class="comment">%-------------------------------------------------------------------------------------------------</span>
0281         paramcnt = 0;
0282         eventdata(1:3) = -1001;
0283         paramsendflag = 0;
0284         pausetime = 0;
0285         <span class="keyword">while</span> ~paramsendflag
0286             eventdata = invoke(cheetah,<span class="string">'GetEventDataAsDouble'</span>,p.EventObjName);
0287             <span class="comment">% read upcoming events as parameter values</span>
0288            <span class="keyword">if</span> (eventdata(1) &lt; 0);
0289                 pause(.01);
0290                 pausetime = pausetime + .01;
0291                 <span class="keyword">if</span> pausetime&gt;1;
0292                     fprintf(1,<span class="string">'\nWARNING: waited more than 1 second for parameter value !'</span>);
0293                     fprintf(logfid,<span class="string">'\nWARNING: waited more than 1 second for parameter value !'</span>);
0294                     <span class="keyword">break</span>;
0295                 <span class="keyword">end</span>
0296             <span class="keyword">elseif</span> (eventdata(1) &gt; 0 &amp; eventdata(3) ~= 0)
0297                 pausetime = 0;
0298                 [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = <a href="#_sub1" class="code" title="subfunction [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = registerevent(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt)">registerevent</a>(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt);
0299                 <span class="comment">% detect end of stimparameter (pattern: p.SendParamEnd 0 p.SendParamEnd)</span>
0300                 <span class="keyword">if</span> (evcnt&gt;=2) &amp; (evTTL(evcnt-1)==p.SendParamEnd &amp; evTTL(evcnt)==p.SendParamEnd)
0301                     evType(evcnt) = 1;
0302                     <a href="#_sub2" class="code" title="subfunction printeventmessage(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt)">printeventmessage</a>(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt);
0303                     paramsendflag = 1;
0304                     <span class="keyword">break</span>;
0305                 <span class="keyword">else</span>
0306                     evType(evcnt) = 3;
0307                     <a href="#_sub2" class="code" title="subfunction printeventmessage(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt)">printeventmessage</a>(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt);
0308                 <span class="keyword">end</span>
0309                 
0310             <span class="keyword">end</span>
0311         <span class="keyword">end</span>
0312         
0313         paramArray = NaN;
0314         paramArray = [evTime(evType==3)' evTTL(evType==3)'];
0315         <span class="comment">% neglect last entries (stop event)</span>
0316         paramArray = paramArray(1:end-1,:);
0317         paramcnt = size(paramArray,1);
0318         
0319         fprintf(1,<span class="string">'\n==&gt; '</span>);fprintf(1,<span class="string">'(%u values): '</span>,paramcnt);fprintf(1,<span class="string">'%u '</span>,paramArray(:,2)');
0320         fprintf(logfid,<span class="string">'\n==&gt; '</span>);fprintf(logfid,<span class="string">'(%u values): '</span>,paramcnt);fprintf(logfid,<span class="string">'%u '</span>,paramArray(:,2)');
0321         
0322         <span class="comment">% first parameter should give numbers of parameter</span>
0323         <span class="keyword">if</span> paramcnt~=paramArray(1,2)
0324             fprintf(1,<span class="string">'\nWARNING: unexpected number of parameter -&gt; do_READ_flag = 0!'</span>);
0325             fprintf(logfid,<span class="string">'\nWARNING: unexpected number of parameter -&gt; do_READ_flag = 0!'</span>);
0326             do_READ_flag = 0; <span class="comment">% dont read data if there are any</span>
0327             <span class="comment">%irregularities in the number of parameters</span>
0328         <span class="keyword">end</span>
0329         
0330     <span class="keyword">elseif</span> eventdata(3)== p.TrialEndEvent<span class="comment">%-------------------------------------------------------------------------------------------------</span>
0331         
0332         <span class="comment">% add trial end event to @al_spk object</span>
0333         <span class="keyword">if</span> is_READ_flag
0334             <span class="keyword">for</span> i=currTRIALinObj
0335                 s.events{p.EventCode == p.TrialEndEvent,i} = evTime(evTTL==p.TrialEndEvent &amp; (evType==0|evType==1)) - s.align(i).*1000;
0336             <span class="keyword">end</span>
0337         <span class="keyword">end</span>
0338         
0339         currCnd = NaN;
0340         currTRIALinObj = zeros(1,p.PresentationNum).*NaN; 
0341         evcnt = 0;
0342         fprintf(logfid,<span class="string">'\nEND OF TRIAL'</span>);
0343         fprintf(1,<span class="string">'\nEND OF TRIAL'</span>);
0344         
0345         TRIAL_HANDBRAKE = 1;
0346         
0347     <span class="keyword">elseif</span> eventdata(3)== p.ReadDataEvent<span class="comment">%-------------------------------------------------------------------------------------------------</span>
0348         
0349         <span class="comment">% check for save reading of trial data</span>
0350         <span class="keyword">if</span> any(~ismember(p.MandatoryEvents,evTTL(evType==0|evType==1))) 
0351             fprintf(1,[<span class="string">'\nWARNING: OMIT trial due to MISSING EVENTS '</span> num2str(p.MandatoryEvents(~ismember(p.MandatoryEvents,evTTL(evType==0|evType==1)))) <span class="string">' !'</span>]);
0352             fprintf(logfid,[<span class="string">'\nWARNING: OMIT trial due to MISSING EVENTS '</span> num2str(p.MandatoryEvents(~ismember(p.MandatoryEvents,evTTL(evType==0|evType==1)))) <span class="string">' !'</span>]);
0353         <span class="keyword">elseif</span> currCndNum ~=p.PresentationNum
0354             fprintf(1,[<span class="string">'\nWARNING: OMIT trial due to NON EXPECTED NUMBER OF PRESENTATIONS !'</span>]);
0355             fprintf(logfid,[<span class="string">'\nWARNING: OMIT trial due to NON EXPECTED NUMBER OF PRESENTATIONS !'</span>]);
0356         <span class="keyword">elseif</span> ~do_READ_flag    
0357             fprintf(1,[<span class="string">'\nWARNING: OMIT trial due to do_READ_flag=0 !'</span>]);
0358             fprintf(logfid,[<span class="string">'\nWARNING: OMIT trial due to do_READ_flag=0 !'</span>]);
0359         <span class="keyword">elseif</span> any(~ismember(currCnd,[1:p.Cndnum]))    
0360             fprintf(1,[<span class="string">'\nWARNING: OMIT trial due to wrong condition information !'</span>]);
0361             fprintf(logfid,[<span class="string">'\nWARNING: OMIT trial due to wrong condition information!'</span>]);
0362         <span class="keyword">else</span>
0363             
0364             <span class="comment">%</span>
0365             is_READ_flag = 1;
0366             
0367             <span class="comment">%*********************************************************************************************************</span>
0368             currSpikeTime = spikedata(1);<span class="comment">% current data in spikedata</span>
0369             
0370             <span class="comment">% define data acquisition window for spikes</span>
0371             spkacqwin = [evTime(evTTL==p.AcqEvents(1) &amp; (evType==0|evType==1)) + p.AcqOffset(1).*1000 , <span class="keyword">...</span>
0372                     evTime(evTTL==p.AcqEvents(2) &amp; (evType==0|evType==1)) + p.AcqOffset(2).*1000];
0373             fprintf(1,<span class="string">'\nSPIKES: 1st spike @%12.0f, acq win %12.0f - %12.0f = %12.0f'</span>,currSpikeTime,spkacqwin(1),spkacqwin(2),spkacqwin(2)-spkacqwin(1));
0374             fprintf(logfid,<span class="string">'\nSPIKES: 1st spike @%12.0f, acq win %12.0f - %12.0f = %12.0f'</span>,currSpikeTime,spkacqwin(1),spkacqwin(2),spkacqwin(2)-spkacqwin(1));
0375             
0376             <span class="comment">% get spikes within the data acquisition window</span>
0377             spkcnt = 0;
0378             flushnum = 0;
0379             pausetime = 0;
0380             pausetimeTotal = 0;
0381             spkreadloopcnt = 0;
0382             <span class="keyword">while</span>   (spikedata(1) &lt;= spkacqwin(2)) &amp;  (pausetime&lt;3)
0383                 
0384                 spkreadloopcnt = spkreadloopcnt +1;
0385                 
0386                 <span class="keyword">if</span> spikedata(1) &lt; 0 <span class="comment">% no spikes in cheetah</span>
0387                     pause(.01);
0388                     pausetime = pausetime + .01;
0389                     pausetimeTotal = pausetimeTotal +.01;
0390                     
0391                 <span class="keyword">elseif</span> (spikedata(1) &gt;= 0) &amp; (spikedata(1) &lt; spkacqwin(1)) <span class="comment">% spike not in window</span>
0392                     flushnum = flushnum+1;
0393                     
0394                 <span class="keyword">elseif</span> spikedata(1) &gt;= spkacqwin(1) <span class="comment">% read spike</span>
0395                     
0396                     <span class="comment">% reset pause time</span>
0397                     pausetime = 0;
0398                     
0399                     <span class="comment">% add current spike to array</span>
0400                     spkcnt = spkcnt + 1;
0401                     spkTime(spkcnt) = spikedata(1);
0402                     spkChannel(spkcnt) = spikedata(2);
0403                     spkCell(spkcnt) = spikedata(3);
0404                     
0405                 <span class="keyword">end</span>
0406                 
0407                 <span class="comment">% get next spike</span>
0408                 spikedata = invoke(cheetah,<span class="string">'GetSpikeDataAsDouble'</span>,p.SpikeObjName{1});
0409             <span class="keyword">end</span>
0410             
0411             <span class="comment">% message</span>
0412             <span class="keyword">if</span> pausetime&gt;=3
0413                 fprintf(1,<span class="string">'\nWARNING: waited more than 3 seconds to read valid spike data from cheetah!'</span>);
0414                 fprintf(logfid,<span class="string">'\nWARNING: waited more than 3 seconds to read valid spike data from cheetah!'</span>);
0415             <span class="keyword">end</span>
0416             
0417             fprintf(1,<span class="string">'\nSPIKES: %5u flushed, %5u read, %u iterations'</span>,flushnum,spkcnt,spkreadloopcnt);
0418             fprintf(logfid,<span class="string">'\nSPIKES: %5u flushed, %5u read, %u iterations'</span>,flushnum,spkcnt,spkreadloopcnt);
0419             
0420             spkacqwin = [0 0]; <span class="comment">% reset spike acq window</span>
0421             <span class="comment">%*********************************************************************************************************</span>
0422                         
0423             
0424             <span class="comment">%++++++++++++++ read data into structure ++++++++++++++++++++++++++++++++++++</span>
0425             <span class="comment">%#####################################</span>
0426             <span class="comment">%##### convert times to MILLISECONDS #</span>
0427             <span class="comment">%#####################################</span>
0428             evTime = evTime.*0.001;
0429             spkTime = spkTime.*0.001;
0430             
0431             <span class="comment">%----------------------------------------------------------</span>
0432             <span class="comment">% specific windows for each single condition/presentation</span>
0433             <span class="comment">% get condition specific acquisition times</span>
0434             LoWin = evTime(ismember(evTTL,p.CndAcqEventsLo) &amp; (evType==0|evType==1)) + p.CndAcqOffset(1);<span class="comment">% use 'ismember' here in case of more than one event defining an acquisition window</span>
0435             HiWin = evTime(ismember(evTTL,p.CndAcqEventsHi) &amp; (evType==0|evType==1)) + p.CndAcqOffset(2);
0436             AlignTime = evTime(evTTL==p.CndAlignEvent &amp; (evType==0|evType==1)) + p.CndAlignOffset;
0437             <span class="comment">% make sure you get as many windows as pesented conditions</span>
0438             LoWin = LoWin(1:p.PresentationNum);
0439             HiWin = HiWin(1:p.PresentationNum);
0440             AlignTime = AlignTime(1:p.PresentationNum);
0441             <span class="comment">% set spike acquisition limits for conditions of first and last stimulus</span>
0442             <span class="comment">% presentation, to make sure to get ALL spikes in p.AcqEvents</span>
0443             LoWin(1) = evTime(evTTL==p.AcqEvents(1) &amp; (evType==0|evType==1))+p.AcqOffset(1).*0.001;
0444             HiWin(end) = evTime(evTTL==p.AcqEvents(2) &amp; (evType==0|evType==1))+p.AcqOffset(2).*0.001;
0445             <span class="comment">%----------------------------------------------------------</span>
0446             
0447             TRIALCNTcortex = TRIALCNTcortex+1;
0448             
0449             <span class="comment">% read data into @al_spk object</span>
0450             <span class="keyword">for</span> i = 1:p.PresentationNum
0451                 TRIALCNTinObj = TRIALCNTinObj+1;
0452                 TRIALCNTinObj2 = TRIALCNTinObj2 + 1;
0453                 currTRIALinObj(i) = TRIALCNTinObj2;
0454                 s.trialcode(spk_BlockInd,TRIALCNTinObj) = currBlock;
0455                 s.trialcode(spk_CndInd,TRIALCNTinObj) = currCnd(i);
0456                 s.trialcode(spk_TrialInd,TRIALCNTinObj) = TRIALCNTinObj2;
0457                 s.trialcode(spk_PresentNrInd,TRIALCNTinObj) = i;
0458                 s.trialcode(spk_cortextrialcountind,TRIALCNTinObj) = TRIALCNTcortex;
0459                 s.trialcode(spk_startedtrialcountind,TRIALCNTinObj) = TRIALCNTstarted;
0460                 s.trialcode(spk_timeInd) = currTrialTime;
0461                 s.align(TRIALCNTinObj) = AlignTime(i);
0462                 <span class="comment">% every trial in data structure has ALL the events of a</span>
0463                 <span class="comment">% cortex trial</span>
0464                 fprintf(logfid,<span class="string">'\nSPIKES: pres.# %u acq win %12.0f - %12.0f = %12.0f'</span>,i,LoWin(i),HiWin(i),HiWin(i)-LoWin(i));
0465                 <span class="keyword">for</span> j=1:length(p.EventCode)
0466                     s.events{j,TRIALCNTinObj} = evTime(evTTL==p.EventCode(j) &amp; (evType==0|evType==1)) - s.align(TRIALCNTinObj);
0467                 <span class="keyword">end</span>
0468                 <span class="keyword">for</span> k = 1:ChanIndexNum
0469                     <span class="comment">% get the spikes within the current condition/presentation window</span>
0470                     s.spk{k,TRIALCNTinObj} = spkTime(spkCell==str2num(s.channel{ChanIndex(k)}) &amp; spkTime&gt;=LoWin(i) &amp; spkTime&lt;=HiWin(i)) - s.align(TRIALCNTinObj);
0471                     <span class="comment">% get all the spikes within the data acquisition window</span>
0472 <span class="comment">%                                             s.spk{k,TRIALCNTinObj} = spkTime(spkCell==(k-1)) - s.align(TRIALCNTinObj);</span>
0473                 <span class="keyword">end</span>
0474                 s.stimulus{TRIALCNTinObj} = paramArray;
0475             <span class="keyword">end</span>
0476             
0477             <span class="comment">%#####################################</span>
0478             <span class="comment">%##### convert times to MICROSECONDS #</span>
0479             <span class="comment">%#####################################</span>
0480             evTime = evTime.*1000;
0481             spkTime = spkTime.*1000;
0482             
0483             <span class="comment">%++++++++++++++ analyse data ++++++++++++++++++++++++++++++++++++</span>
0484             <span class="keyword">for</span> f = 1:size(dofun,1)
0485                 feval(dofun{f,:},s,[TRIALCNTinObj-(currCndNum-1):TRIALCNTinObj],p);
0486             <span class="keyword">end</span>
0487         <span class="keyword">end</span><span class="comment">%read end</span>
0488         
0489         
0490     <span class="keyword">else</span>
0491     <span class="keyword">end</span><span class="comment">% end switch</span>
0492     
0493     eventdata(1) = -1001;
0494     
0495     <span class="keyword">if</span> isempty(FH)
0496         assignin(<span class="string">'base'</span>,<span class="string">'SPK'</span>,s);
0497     <span class="keyword">else</span>
0498         set(FH,<span class="string">'userdata'</span>,s);
0499     <span class="keyword">end</span>
0500 <span class="keyword">end</span>
0501 
0502 currtime = now;
0503 
0504 fprintf(logfid,<span class="string">'\n'</span>);
0505 fprintf(logfid,[<span class="string">'-------------------------------------------------------------------------------\n'</span>]);
0506 fprintf(logfid,[<span class="string">'log file closed: '</span> datestr(currtime,0) <span class="string">' NLX time: %12.0f\n'</span>],invoke(cheetah,<span class="string">'GetTimeStampAsDouble'</span>));
0507 fprintf(logfid,[<span class="string">'-------------------------------------------------------------------------------\n'</span>]);
0508 fprintf(logfid,<span class="string">'\n'</span>);
0509 fprintf(logfid,<span class="string">'\n'</span>);
0510 fclose(logfid);
0511 
0512 release(cheetah);
0513 
0514 <span class="keyword">return</span>
0515            
0516 <span class="comment">%==========================================================================</span>
0517 <a name="_sub1" href="#_subfunctions" class="code">function [eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt] = registerevent(eventdata,evTime,evID,evTTL,evBINhi,evBINlo,evcnt)</a>
0518 <span class="keyword">if</span> eventdata(1)&lt;0
0519     <span class="keyword">return</span>;
0520 <span class="keyword">elseif</span> eventdata(3)&lt;0
0521     eventdata(3) = 2*2^(16-1) + eventdata(3);<span class="comment">% convert negative evTTL, interpreting negative integers as 2's complement</span>
0522 <span class="keyword">end</span>
0523 <span class="keyword">if</span> eventdata(3)&gt;0
0524     evcnt = evcnt + 1;
0525     evTime(evcnt)   = eventdata(1);
0526     evID(evcnt)     = eventdata(2);
0527     evTTL(evcnt)    = eventdata(3);
0528     currBinary       = fliplr(dec2bin(eventdata(3),16));
0529     evBINhi(evcnt,1:8)       =  fliplr(currBinary(9:16));
0530     evBINlo(evcnt,1:8)       =  fliplr(currBinary(1:8));
0531 <span class="keyword">end</span>
0532 
0533 <span class="comment">%==========================================================================</span>
0534 <a name="_sub2" href="#_subfunctions" class="code">function printeventmessage(logfid,evTime,evID,evTTL,evBINhi,evBINlo,evType,p,evcnt)</a>
0535     <span class="comment">%______________________________________________________________________</span>
0536     <span class="comment">% print event message</span>
0537     <span class="keyword">if</span> ~isempty(p) &amp; (p.PrintEventEcho==0)
0538         <span class="keyword">return</span>;
0539     <span class="keyword">end</span>
0540     fprintf(logfid,<span class="string">'\n'</span>);
0541     fprintf(logfid,<span class="string">'%5u '</span>,evcnt);
0542     fprintf(logfid,<span class="string">'%12.0f '</span>,evTime(evcnt));
0543     fprintf(logfid,<span class="string">'%4u '</span>,evID(evcnt));
0544     fprintf(logfid,<span class="string">'%4u '</span>,evType(evcnt));
0545     fprintf(logfid,<span class="string">'%5u '</span>,evTTL(evcnt));
0546     fprintf(logfid,[evBINhi(evcnt,:) <span class="string">' '</span>]);
0547     fprintf(logfid,[evBINlo(evcnt,:) <span class="string">' '</span>]);
0548     fprintf(logfid,<span class="string">'# '</span>);
0549 
0550     lastEvent = find(evTime&lt;evTime(evcnt) &amp; evTTL~=0);
0551     <span class="keyword">if</span> evcnt&gt;1 &amp; ~isempty(lastEvent)
0552         fprintf(logfid,<span class="string">'+ %12.3f ms '</span>,(evTime(evcnt)-evTime(lastEvent(end))).*0.001);
0553     <span class="keyword">else</span>
0554         fprintf(logfid,<span class="string">'  %12.3f ms '</span>,evTime(evcnt).*0.001);
0555     <span class="keyword">end</span>
0556     <span class="keyword">if</span> (~isempty(p)) &amp; (evType(evcnt)==0|evType(evcnt)==1)
0557         fprintf(logfid,[<span class="string">'    '</span> p.EventName{p.EventCode==evTTL(evcnt)}]);
0558     <span class="keyword">end</span>
0559 
0560 <span class="comment">%==========================================================================</span>
0561 <a name="_sub3" href="#_subfunctions" class="code">function [spikedata,flushnum] = flushspikes(cheetah,cheetahobjname,flushwin)</a>
0562 flushnum = 0;
0563 pausetime = 0;
0564 spikedata = -1001;
0565 
0566 spikedata = invoke(cheetah,<span class="string">'GetSpikeDataAsDouble'</span>,cheetahobjname);
0567 <span class="keyword">if</span> spikedata(1)==-101;<a href="../../@al_spk/error.html" class="code" title="function msgOut = error(s,msgIn,caller)">error</a>(<span class="string">'no cheetah object available ...'</span>);<span class="keyword">end</span>
0568 
0569 <span class="keyword">while</span> (spikedata(1) == -1001) | (spikedata(1)&gt;=flushwin(1) &amp; spikedata(1)&lt;=flushwin(2))
0570     <span class="keyword">if</span> spikedata(1) == -1001            <span class="comment">% no spikes in object</span>
0571         pause(0.01);                    <span class="comment">% wait a bit</span>
0572         pausetime = pausetime + .01;    <span class="comment">% increment pause time</span>
0573         <span class="keyword">if</span> pausetime&gt;1;<span class="keyword">break</span>;<span class="keyword">end</span>        <span class="comment">% check for pause limit</span>
0574     <span class="keyword">else</span>
0575         flushnum = flushnum +1;         <span class="comment">% add current spike to flush number</span>
0576         pausetime = 0;                  <span class="comment">% reset pause time</span>
0577     <span class="keyword">end</span>
0578     spikedata = invoke(cheetah,<span class="string">'GetSpikeDataAsDouble'</span>,cheetahobjname);
0579 <span class="keyword">end</span>
0580 
0581 <span class="comment">%==========================================================================</span>
0582 <a name="_sub4" href="#_subfunctions" class="code">function [eventdata,flushnum] = flushevents(cheetah,cheetahobjname,flushwin)</a>
0583 flushnum = 0;
0584 pausenum = 0;
0585 eventdata = -1001;
0586 eventdata = invoke(cheetah,<span class="string">'GetEventDataAsDouble'</span>,cheetahobjname);
0587 <span class="keyword">if</span> eventdata(1)==-101
0588     <a href="../../@al_spk/error.html" class="code" title="function msgOut = error(s,msgIn,caller)">error</a>(<span class="string">'no cheetah object available ...'</span>);
0589 <span class="keyword">end</span>
0590 <span class="keyword">while</span> (eventdata(1) == -1001) | (eventdata(1)&gt;=flushwin(1) &amp; eventdata(1)&lt;=flushwin(2))
0591     <span class="keyword">if</span> eventdata(1) == -1001
0592         pause(0.01);
0593         pausenum = pausenum +1;
0594         <span class="keyword">if</span> pausenum&gt;2;<span class="keyword">break</span>;<span class="keyword">end</span>
0595     <span class="keyword">else</span>
0596         flushnum = flushnum +1;
0597     <span class="keyword">end</span>
0598     eventdata = invoke(cheetah,<span class="string">'GetEventDataAsDouble'</span>,cheetahobjname);
0599 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Tue 25-Apr-2006 16:24:52 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>